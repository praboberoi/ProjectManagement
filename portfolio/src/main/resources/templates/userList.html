<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
  <head>
    <title>User</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <!-- Custom css for body-->
    <link rel="stylesheet" type="text/css" th:href="@{{apiPrefix}/css/body.css(apiPrefix=${apiPrefix})}" />
    <link th:href="@{https://cdn.jsdelivr.net/npm/fullcalendar@5.11.0/main.min.css}" rel='stylesheet' type="text/css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>

  <!--fragments-->
  <header>
    <div th:replace="fragments :: header"></div>
  </header>
  <div th:replace="fragments :: account"></div> 

  <body>
    <div class="main">
      <br>
      <div class="page-title">
        <h2 id="name">Users</h2>
      </div>
      <div>
        <br>
        <div th:if="${messageSuccess}" class="alert alert-success text-center">
          [[${messageSuccess}]]
        </div>
        <div th:if="${messageDanger}" class="alert alert-danger text-center">
          [[${messageDanger}]]
        </div>
      </div>

      <!-- Table for users -->
      <div class="table-border bdr" th:fragment="userListDataTable" id="userListDataTable">
        <table class="table table-bordered table-hover">
          <thead class = "table-light">
            <tr>
              <th scope="col" style="width:auto">Username</th>
              <th scope="col" style="width:auto">Name</th>
              <th scope="col" style="width:auto">Nickname</th>
              <th scope="col" style="width:auto">Roles</th>
            </tr>
          </thead>
          <tbody>
            <th:block th:each="user : ${usersList}">
              <tr th:id="'user' + ${user.userId} + 'Row'">
                <td th:id="'user' + ${user.userId} + 'Username'">[[${user.username}]]</td>
                <td th:id="'user' + ${user.userId} + 'Name'">[[${user.firstName}]]  [[${user.lastName}]]</td>
                <td th:id="'user' + ${user.userId} + 'Nickname'">[[${user.nickname}]]</td>
                <td th:id="'user' + ${user.userId} + 'Roles'">
                  <ul style="list-style-type: none">
                    <th:block th:each = "role : ${user.getRoles()}">
                        <li style="display:inline">
                          <span class="badge badge-pill badge-secondary">[[${role}]]
                            <button th:data-role = '${role}' th:if="!${adminOrTeacher == true}" class="w-25 btn shadow-none btn-sm" onclick="removeRole(this.getAttribute('data-role'))">
                              <img class="icon" width="20" height="20" th:src="@{{apiPrefix}/icons/close-icon.svg(apiPrefix=${apiPrefix})}"/>
                            </button>
                          </span>
                        </li>
                    </th:block>
                  </ul>
              </tr>
            </th:block>
          </tbody>
        </table>
        <nav class="text-center">
          <ul class="pagination justify-content-center">
            <li class="page-item" th:classappend="${page == 0}? 'disabled' : ''">
              <a role='button' class="page-link" th:onclick="'getUserDataTable(0)'"><span aria-hidden="true">&laquo;</span></a>
            </li>

            <li class="page-item" th:classappend="${page == 0}? 'disabled' : ''">
              <a role='button' class="page-link" onclick="prevPage()"><span aria-hidden="true">&lsaquo;</span></a>
            </li>

            <li class="page-item" th:classappend="${(0 == page)? 'active' : ''}">
              <a role='button' class="page-link" th:onclick="'getUserDataTable(0)'" th:text="${1}"></a>
            </li>

            <th:block th:if="${page} > 2 + 1" >
              <li class="page-item">
                <a role='label' class="page-link">...</a>
              </li>
            </th:block>
            
            <th:block th:if="${pages} > 2" th:each="i: ${#numbers.sequence(T(Math).max(2, page - 1), T(Math).min(pages - 1, page + 3))}">
              <li class="page-item" th:classappend="${(i == page + 1)? 'active' : ''}">
                <a role='button' class="page-link" th:onclick="'getUserDataTable(' + ${i - 1} + ')'" th:text="${i}"></a>
              </li>
            </th:block>

            <th:block th:if="${pages - 4} > ${page}" >
              <li class="page-item">
                <a role='label' class="page-link">...</a>
              </li>
            </th:block>

            <th:block th:if="${pages} != 1">
              <li class="page-item" th:classappend="${(pages == page + 1)? 'active' : ''}">
                <a role='button' class="page-link" th:onclick="'getUserDataTable(' + ${pages - 1} + ')'" th:text="${pages}"></a>
              </li>
            </th:block>

            <li class="page-item" th:classappend="${page == pages-1}? 'disabled' : ''">
              <a role='button' class="page-link" onclick="nextPage()"><span aria-hidden="true">&rsaquo;</span></a>
            </li>
            <li class="page-item" th:classappend="${page == pages-1}? 'disabled' : ''">
              <a role='button' class="page-link" th:onclick="'getUserDataTable(' + ${pages - 1} + ')'"><span aria-hidden="true">&raquo;</span></a>
            </li>
          </ul>
        </nav>
    </div>
  </div>

    <script th:src="@{https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js}" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script th:inline="javascript">
      var apiPrefix = [[${apiPrefix}]];
    </script>
    <script th:src='@{/javascript/userList.js}'></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
  </body>
</html>
