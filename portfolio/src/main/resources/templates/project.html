<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
  <title>LENSfolio - [[${project.projectName}]]</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.0/main.min.css" rel='stylesheet' type="text/css" />
  <!-- Custom css for body-->
  <link rel="stylesheet" type="text/css" th:href="@{{apiPrefix}/css/body.css(apiPrefix=${apiPrefix})}" />
  <script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.0/main.min.js'></script>

</head>

<!--fragments-->
<header>
  <input id="websocket-status" hidden>
  <div th:replace="fragments :: header"></div>
</header>
<div th:replace="fragments :: sidebar"></div>

<body>
  <div class="main">
    <br>
    <div class="page-title">
      <h2 id="name">[[${project.projectName}]]</h2>
      <input type="hidden" id="projectId" name="projectId" th:value="${project.projectId}">
    </div>
    <div>
      <br>
      <div id="messageSuccess" class="alert alert-success text-center">[[${messageSuccess}]]</div>
      <div id="messageDanger" class="alert alert-danger text-center">[[${messageDanger}]]</div>
    </div>
    <br>
    <nav>
      <div class="nav nav-tabs" id="nav-tab" role="tablist">
        <button class="nav-link active" id="projectDescriptionNav" type="button" role="tab" aria-selected="true"
          onclick="navTOProjectDescription()">Project Details</button>
        <button class="nav-link" type="button" id="plannerNav" role="tab" aria-selected="false"
          onclick="navToPlanner()">Planner</button>
        <button class="nav-link disabled" id="projectDuration" type="button" role="tab" aria-selected="false"
          aria-disabled="true">
          Duration: [[${#dates.format(project.startDate,'dd MMM yyyy')}]] to [[${#dates.format(project.endDate,'dd MMM
          yyyy')}]]
        </button>

      </div>
      <br>
    </nav>
    <div class="container-flex row mx-0" id="projectCard" hidden>
      <div class="card col-lg-5 col-12 mh-100 px-0 mb-5 mb-lg-0 mr-3" id="detailsCard">

        <div class="card-header">
          <input type="hidden" id="startDate" th:value="*{project.startDate}" />
          <input type="hidden" id="endDate" th:value="*{project.endDate}" />
          <h5>Project Description</h5>
          <div id="edit-del-buttons">
            <div class="container-fluid d-flex justify-content-end px-0" th:if="${adminOrTeacher}">
              <a type="button" class="btn btn-outline-primary mx-1"
                th:href="@{${apiPrefix} + '/dashboard/editProject/'+ ${project.projectId}}">
                <img class="icon img-color-primary"
                  th:src="@{{apiPrefix}/icons/edit-icon.svg(apiPrefix=${apiPrefix})}" />Edit</a>
              <button type="button" class="btn btn-outline-secondary" data-bs-toggle="modal"
                data-bs-target="#conformationModalProject" th:data-id="${project.projectId}"
                th:data-prefix="${apiPrefix}" th:data-name="${project.projectName}"
                th:onclick="updateProjectDetails(this.getAttribute('data-id'), this.getAttribute('data-name'), this.getAttribute('data-prefix'))">
                <img class="icon img-color-secondary"
                  th:src="@{{apiPrefix}/icons/trash-icon.svg(apiPrefix=${apiPrefix})}" /> Delete</button>
            </div>
          </div>
        </div>
        <div class="card-body" id="projectDescription">
          <p class="card-text">[[${project.Description}]]</p>
        </div>


      </div>

      <!--    Tabs for events/deadlines/milestones-->
      <div class="card col-lg-6 col-12 mh-100 px-0 ml-lg-5" id="calendarOb">
        <ul class="nav nav-tabs pt-1 pl-1" id="myTab" role="tablist">
          <li class="nav-item" role="presentation" href="#home">

            <button class="nav-link active px-2 px-sm-3" id="event-tab" data-bs-toggle="tab" data-bs-target="#event"
              type="button" role="tab" aria-controls="event" aria-selected="true">
              <img th:src="@{{apiPrefix}/icons/bookmark-heart.svg(apiPrefix=${apiPrefix})}" alt="Events" height=16
                width=16 class="calendarIcons">
              Events</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link px-2 px-sm-3" id="deadline-tab" data-bs-toggle="tab" data-bs-target="#deadline"
              type="button" role="tab" aria-controls="deadline" aria-selected="false">
              <img th:src="@{{apiPrefix}/icons/calendar-check.svg(apiPrefix=${apiPrefix})}" alt="Deadlines" height=16
                width=16 class="calendarIcons">
              Deadlines</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link px-2 px-sm-3" id="milestone-tab" data-bs-toggle="tab" data-bs-target="#milestone"
              type="button" role="tab" aria-controls="milestones" aria-selected="false">
              <img th:src="@{{apiPrefix}/icons/trophy.svg(apiPrefix=${apiPrefix})}" alt="Milestones" height=16 width=16
                class="calendarIcons">
              Milestones</button>
          </li>
        </ul>

        <div class="tab-content" id="myTabContent">
          <div class="tab-pane fade show active" id="event" role="tabpanel" aria-labelledby="event-tab">
            <div th:if="${adminOrTeacher}">
              <!-- If a user is a STUDENT do not show the 'create' event button !-->
              <div class="createBtn">
                <button class="btn btn-outline-primary btn-sm" id="create-event-btn" data-bs-toggle="modal"
                  data-bs-target="#eventFormModal" th:data-id="${event.eventId}" th:data-name="${event.eventName}"
                  th:data-startDate="${event.startDate}" th:data-endDate="${event.endDate}"
                  th:onclick="populateEventModal(false, this.getAttribute('data-id'), this.getAttribute('data-name'), this.getAttribute('data-startDate'), this.getAttribute('data-endDate'))">
                  <img class="icon img-color-primary"
                    th:src="@{{apiPrefix}/icons/create-icon.svg(apiPrefix=${apiPrefix})}" /> Create Event</button>
              </div>
            </div>

            <!--          Shows each individual event-->
            <div class="container">
              <div id="event-list"></div>
            </div>

          </div>
          <div class="tab-pane fade" id="deadline" role="tabpanel" aria-labelledby="deadline-tab">
            <div th:if="${adminOrTeacher}">
              <!-- If a user is a STUDENT do not show the 'create' deadline button !-->
              <div class="createBtn">
                <button type="button" class="btn btn-outline-primary btn-sm" id="deadline-btn" data-bs-backdrop="static"
                  data-bs-keyboard="false" th:onclick="createDeadline()">
                  <img class="icon img-color-primary"
                    th:src="@{{apiPrefix}/icons/create-icon.svg(apiPrefix=${apiPrefix})}" />
                  Create Deadline</button>
              </div>
            </div>
              <div class="container">
            <div id="deadline-list"></div>
              </div>
          </div>
          <div class="tab-pane fade" id="milestone" role="tabpanel" aria-labelledby="milestone-tab">
            <div th:if="${adminOrTeacher}">
              <!-- If a user is a STUDENT do not show the 'create' milestone button !-->
              <div class="createBtn">
                <button type="button" class="btn btn-outline-primary btn-sm" id="milestone-btn"
                  data-bs-backdrop="static" data-bs-keyboard="false" th:onclick="createMilestone()">
                  <img class="icon img-color-primary"
                    th:src="@{{apiPrefix}/icons/create-icon.svg(apiPrefix=${apiPrefix})}" />
                  Create Milestone</button>
              </div>
            </div>
              <div class="container">
            <div id="milestone-list" th:insert="milestoneFragments::milestoneTab"></div>
              </div>
          </div>
        </div>
      </div>
    </div>

    <div id="sprintLabel" hidden>
      <br>
      <br>

      <div class="container-fluid d-flex p-0">
        <h3 class="pe-3">Sprints</h3>
        <!-- If a user is a STUDENT do not show the 'create', 'edit', 'delete' sprint buttons !-->
        <div th:if="${adminOrTeacher}">
          <a class="btn btn-outline-primary" id="sprint-btn"
            th:href="@{${apiPrefix} + '/project/' + ${projectId} + '/newSprint'}">
            <img class="icon img-color-primary"
              th:src="@{{apiPrefix}/icons/create-icon.svg(apiPrefix=${apiPrefix})}" /></a>
        </div>
      </div>
    </div>
    <br>
    <div id="showSprints">
      <!-- Table for sprints -->
      <div class="table-border table-responsive bdr">
        <table class="table accordion">
          <thead class="table-light">
            <tr>
              <th scope="col" style="width:auto">Sprint Label</th>
              <th scope="col" style="width:auto">Sprint Name</th>
              <th class="d-none d-md-table-cell" scope="col" style="width:auto">Description</th>
              <th scope="col" style="width:auto">Start Date</th>
              <th scope="col" style="width:auto">End Date</th>
              <th style="width:auto"></th>
            </tr>
          </thead>
          <tbody>
            <div id="sprint-list">
              <th:block th:each="sprint : ${listSprints}" th:fragment="sprints">
                <tr th:id="'sprint' + ${sprint.sprintId} + 'Row'"
                  th:style="'border-bottom: 5px solid ' + ${sprint.color.getColor()}">
                  <td th:id="'sprint' + ${sprint.sprintId} + 'Label'">
                    <button class="accordion-button collapsed" type="button" id="toggle-display"
                      data-bs-toggle="collapse" th:data-bs-target="'#showSprint' + ${sprint.sprintId}"
                      aria-controls="collapseOne" aria-expanded="false">
                      [[${sprint.sprintLabel}]]
                    </button>
                  </td>
                  <td th:id="'sprint' + ${sprint.sprintId} + 'Name'">[[${sprint.sprintName}]]</td>
                  <td class="d-none d-md-table-cell" th:id="'sprint' + ${sprint.sprintId} + 'Description'">
                    [[${sprint.description}]]</td>
                  <td th:id="'sprint' + ${sprint.sprintId} + 'StartDate'">[[${#dates.format(sprint.startDate, 'dd MMM
                    yyyy')}]]</td>
                  <td th:id="'sprint' + ${sprint.sprintId} + 'EndDate'">[[${#dates.format(sprint.endDate, 'dd MMM
                    yyyy')}]]</td>
                  <td>
                    <!--               If a user is a STUDENT do not show the 'create', 'edit', 'delete' sprint buttons !-->
                    <div th:if="${adminOrTeacher}">
                      <a type="button" class="btn btn-outline-primary mr-2" id="sprint-edit-btn"
                        th:href="@{${apiPrefix} + '/project/' + ${projectId} + '/editSprint/' + ${sprint.sprintId}}">
                        <img class="icon img-color-primary"
                          th:src="@{{apiPrefix}/icons/edit-icon.svg(apiPrefix=${apiPrefix})}" />
                        <span class="d-none d-md-inline-block">Edit</span></a>
                      <button type="button" class="btn btn-outline-secondary" id="sprint-del-btn" data-bs-toggle="modal"
                        data-bs-target="#conformationModalSprint" th:data-projectId="${project.projectId}"
                        th:data-prefix="${apiPrefix}" th:data-sprintId="${sprint.sprintId}"
                        th:data-name="${sprint.sprintName}"
                        th:onclick="updateSprintDetails(this.getAttribute('data-sprintId'), this.getAttribute('data-name'), this.getAttribute('data-projectId'), this.getAttribute('data-prefix'))">
                        <img class="icon img-color-secondary"
                          th:src="@{{apiPrefix}/icons/trash-icon.svg(apiPrefix=${apiPrefix})}" />
                        <span class="d-none d-md-inline-block">Delete</span></button>
                    </div>
                  </td>
                </tr>

                <tr id="hidden-display">
                  <td colspan="100%" class="hidden-row">
                    <div th:id="'showSprint'+ ${sprint.sprintId}" class="accordion-collapse collapse"
                      data-bs-parent=".table">
                      <div class="accordion-body">
                        <!-- Show Events -->
                        <div class="outer-box" id="event-display">
                          <div class="inner-box">
                            <div class="heading-size">
                              <img th:src="@{{apiPrefix}/icons/bookmark-heart.svg(apiPrefix=${apiPrefix})}" alt="Events"
                                height=16 width=16 class="calendarIcons">
                              Events
                            </div><br>
                            <th:block th:each="event : ${listEvents}">
                              <div th:if="${(event.startDate <= sprint.endDate and event.endDate >= sprint.startDate)}">
                                <b>[[${event.eventName}]]</b>
                                <br><b>Start Date:</b> [[${#dates.format(event.startDate, 'dd MMM yyyy HH:mm a')}]]
                                <br><b>End Date:</b> [[${#dates.format(event.endDate, 'dd MMM yyyy HH:mm a')}]]
                              </div>
                            </th:block>
                          </div>
                        </div>
                        <!-- Show Deadlines -->
                        <div class="outer-box" id="deadline-display">
                          <div class="inner-box">
                            <div class="heading-size">
                              <img th:src="@{{apiPrefix}/icons/calendar-check.svg(apiPrefix=${apiPrefix})}" alt="Events"
                                height=16 width=16 class="calendarIcons">
                              Deadlines
                            </div><br>
                            <th:block th:each="deadline : ${listDeadlines}">
                              <div th:if="${(deadline.date >= sprint.startDate and deadline.date <= sprint.endDate)}">
                                <b>[[${deadline.name}]]</b>
                                <br><b>Date:</b> [[${#dates.format(deadline.date, 'dd MMM yyyy HH:mm a')}]]
                              </div>
                            </th:block>
                          </div>
                        </div>
                        <div class="outer-box" id="milestone-display">
                          <div class="inner-box">
                            <div class="heading-size">
                              <img hidden th:src="@{{apiPrefix}/icons/trophy.svg(apiPrefix=${apiPrefix})}" alt="Events"
                                height=16 width=16 class="calendarIcons">
                            </div><br>
                          </div>
                        </div>
                      </div>
                    </div>
                  </td>
                </tr>
              </th:block>
            </div>
          </tbody>
        </table>
      </div>
    </div>

    <div id="showEventLabel" hidden>

    </div>
    <div id="cal">
      <div id="calendarMessage" class="alert text-center"></div>
      <div id='calendar' />
    </div>
  </div>

  <div class="modal fade" id="conformationModalProject" tabindex="-1" role="dialog"
    aria-labelledby="conformationModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="conformationModalLongTitleProject">Delete Project</h5>
          <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p id="messageProject"></p>
        </div>
        <div class="modal-footer">
          <form action="" method="post" id="deleteProject">
            <button type="submit" class="btn btn-outline-primary"><img class="icon img-color-primary"
                th:src="@{{apiPrefix}/icons/trash-icon.svg(apiPrefix=${apiPrefix})}" /> Delete</button>
          </form>
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
            <img class="icon img-color-secondary"
              th:src="@{{apiPrefix}/icons/close-icon.svg(apiPrefix=${apiPrefix})}" /> Close</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="conformationModalEvent" tabindex="-1" role="dialog"
    aria-labelledby="conformationModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="conformationModalLongTitleEvent">Delete Event</h5>
          <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p id="messageEvent"></p>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-outline-primary" id="deleteEvent-btn" data-bs-dismiss="modal"><img
              class="icon img-color-secondary" th:src="@{{apiPrefix}/icons/trash-icon.svg(apiPrefix=${apiPrefix})}" />
            Delete</button>
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
            <img class="icon img-color-secondary"
              th:src="@{{apiPrefix}/icons/close-icon.svg(apiPrefix=${apiPrefix})}" /> Close</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="conformationModalSprint" tabindex="-1" role="dialog"
    aria-labelledby="conformationModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="conformationModalLongTitle">Delete Sprint</h5>
          <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p id="message"></p>
        </div>
        <div class="modal-footer">
          <form action="" method="post" id="deleteSprint">
            <button type="submit" class="btn btn-outline-primary"><img class="icon img-color-primary"
                th:src="@{{apiPrefix}/icons/trash-icon.svg(apiPrefix=${apiPrefix})}" /> Delete</button>
          </form>
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
            <img class="icon img-color-secondary"
              th:src="@{{apiPrefix}/icons/close-icon.svg(apiPrefix=${apiPrefix})}" /> Close</button>
        </div>
      </div>
    </div>
  </div>

  <div th:replace="forms :: eventsForm"></div>
  <div th:replace="forms :: deadlineForm"></div>
  <div th:replace="forms :: milestoneForm"></div>
  <script th:inline="javascript">
    let userRoles = [[${ roles }]];
    const projectId = [[${ project.projectId }]];
    let projectStartDate = [[${ project.startDate }]];
    let projectEndDate = [[${ project.endDate }]];
    const apiPrefix = [[${ apiPrefix }]];
    const DATE_OPTIONS = { year: 'numeric', month: 'short', day: 'numeric' };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/@stomp/stompjs@6.1.2/bundles/stomp.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
    crossorigin="anonymous"></script>
  <script th:src="@{{apiPrefix}/javascript/project.js(apiPrefix=${apiPrefix})}"></script>
  <script th:src="@{{apiPrefix}/javascript/dashboard.js(apiPrefix=${apiPrefix})}"></script>
  <script th:src='@{{apiPrefix}/javascript/calendar.js(apiPrefix=${apiPrefix})}'></script>
</body>

</html>